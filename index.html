<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Ecosystem Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
      color: white;
    }
    
    .toolbar {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      border-radius: 40px;
      display: flex;
      gap: 16px;
      padding: 12px 20px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.6);
      z-index: 100;
      justify-content: center;
      align-items: center;
      transition: transform 0.3s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .tool {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tool.disabled {
      background: rgba(255, 255, 255, 0.2);
      cursor: not-allowed;
    }

    .tool.active {
      background: rgba(255, 255, 255, 0.4);
    }

    .tool i {
      font-size: 24px;
      color: white;
    }

    /* Modal styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 200;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: #222;
      padding: 20px;
      border-radius: 40px;
      text-align: center;
      max-width: 400px;
      width: 100%;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div class="toolbar">
    <div class="tool active" data-tool="attract" title="Attract Tool">
      <i>🌟</i>
    </div>
    <div class="tool" data-tool="repel" title="Repel Tool">
      <i>💨</i>
    </div>
    <div class="tool" data-tool="draw" title="Draw Barrier">
      <i>✏️</i>
    </div>
    <div class="tool" data-tool="erase" title="Erase Barrier">
      <i>🧹</i>
    </div>
    <div class="tool" data-tool="red" title="Add Red Particle">
      <i>🔴</i>
    </div>
    <div class="tool" data-tool="blue" title="Add Blue Particle">
      <i>🔵</i>
    </div>
    <div class="tool" data-tool="yellow" title="Add Yellow Particle">
      <i>🟡</i>
    </div>
    <div class="tool" data-tool="freeze" title="Freeze Particles">
      <i>❄️</i>
    </div>
    <div class="tool" data-tool="clear" title="Clear All Particles">
      <i>🧨</i>
    </div>
    <div class="tool" data-tool="chemistry" title="Toggle Chemistry Mode">
      <i>⚗️</i>
    </div>
    
    <!-- New tools for Particle Accelerator, Save, Background -->
    <div class="tool" data-tool="accelerator" title="Particle Accelerator">
      <i>⚡</i>
    </div>
    <div class="tool" data-tool="save" title="Save Game">
      <i>💾</i>
    </div>
    <div class="tool" data-tool="background" title="Customize Background">
      <i>🎨</i>
    </div>

    <!-- New tool for toggling random particle spawning -->
    <div class="tool" data-tool="random-spawn" title="Toggle Random Particle Spawning">
      <i>🔄</i>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particles = [];
    let barriers = [];
    let isChemistryMode = false;
    let isRandomSpawningEnabled = true;
    let currentTool = 'attract';

    // Toggle Chemistry Mode
    document.querySelector('[data-tool="chemistry"]').addEventListener('click', () => {
      isChemistryMode = !isChemistryMode;
      alert(isChemistryMode ? 'Chemistry Mode Activated!' : 'Sandbox Mode Activated!');
      toggleNonChemistryTools(isChemistryMode);
      toggleAdditionalTools(isChemistryMode);
    });

    // Toggle Random Particle Spawning
    document.querySelector('[data-tool="random-spawn"]').addEventListener('click', () => {
      isRandomSpawningEnabled = !isRandomSpawningEnabled;
      alert(isRandomSpawningEnabled ? 'Random Particle Spawning Enabled' : 'Random Particle Spawning Disabled');
    });

    // Disable/Enable non-chemistry tools when Chemistry Mode is enabled or disabled
    function toggleNonChemistryTools(enabled) {
      const toolsToDisable = [
        'attract', 'repel', 'draw', 'erase', 'freeze'
      ];
      toolsToDisable.forEach(tool => {
        const toolElement = document.querySelector(`[data-tool="${tool}"]`);
        if (enabled) {
          toolElement.classList.add('disabled');
          toolElement.style.pointerEvents = 'none'; // Disable clicks
        } else {
          toolElement.classList.remove('disabled');
          toolElement.style.pointerEvents = 'auto'; // Re-enable clicks
        }
      });
    }

    // Disable/Enable the additional tools in Non-Chemistry Mode
    function toggleAdditionalTools(enabled) {
      const additionalTools = [
        'accelerator', 'save', 'background'
      ];
      additionalTools.forEach(tool => {
        const toolElement = document.querySelector(`[data-tool="${tool}"]`);
        if (enabled) {
          toolElement.classList.add('disabled');
          toolElement.style.pointerEvents = 'none'; // Disable clicks
        } else {
          toolElement.classList.remove('disabled');
          toolElement.style.pointerEvents = 'auto'; // Re-enable clicks
        }
      });
    }

    // Chemistry reactions: Real-life chemical reactions
    const reactions = {
      'red-blue': 'purple',
      'blue-yellow': 'green',  // Updated: Blue + Yellow => Green
      'red-yellow': 'orange',
      'red-red': 'purple',
      'blue-blue': 'blue',
    };

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.size = 6;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = (Math.random() - 0.5) * 4;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;

        // Handle particle collisions
        for (let i = 0; i < particles.length; i++) {
          const p2 = particles[i];
          if (p2 !== this && this.collidesWith(p2)) {
            if (isChemistryMode) {
              this.reactWith(p2);
            }
          }
        }

        // Wall bounce logic
        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
      }

      collidesWith(other) {
        const dx = this.x - other.x;
        const dy = this.y - other.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        return distance < this.size * 2;
      }

      reactWith(other) {
        const reactionKey = [this.color, other.color].sort().join('-');
        const newColor = reactions[reactionKey];

        if (newColor) {
          // Create new particle with the resulting color
          particles.push(new Particle(this.x, this.y, newColor));
        }

        // Remove particles after reaction
        particles = particles.filter(p => p !== this && p !== other);
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.closePath();

        if (isChemistryMode) {
          ctx.font = '16px Arial';
          ctx.fillStyle = 'white';
          ctx.fillText(this.color.charAt(0).toUpperCase() + this.color.slice(1), this.x - this.size, this.y - this.size - 10);
        }
      }
    }

    // Random particle spawning function
    function randomParticleSpawner() {
      if (!isChemistryMode && isRandomSpawningEnabled) {
        const colors = ['red', 'blue', 'yellow'];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        particles.push(new Particle(Math.random() * canvas.width, Math.random() * canvas.height, randomColor));
      }
    }

    // Event listeners for tool actions
    document.querySelector('[data-tool="red"]').addEventListener('click', () => {
      particles.push(new Particle(Math.random() * canvas.width, Math.random() * canvas.height, 'red'));
    });

    document.querySelector('[data-tool="blue"]').addEventListener('click', () => {
      particles.push(new Particle(Math.random() * canvas.width, Math.random() * canvas.height, 'blue'));
    });

    document.querySelector('[data-tool="yellow"]').addEventListener('click', () => {
      particles.push(new Particle(Math.random() * canvas.width, Math.random() * canvas.height, 'yellow'));
    });

    // Animation loop
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => p.update());
      particles.forEach(p => p.draw());
      requestAnimationFrame(animate);
    }

    // Run the random spawning function periodically in non-Chemistry Mode
    setInterval(randomParticleSpawner, 1000);

    animate();
  </script>
</body>
</html>
